<?/** URL 을 분석하여 controller 와 action 값을 알아낸다.* 컨트롤러의 서브경로 지원토록 수정*/class Lemon_Init {	private $baseurl = '';	public $controller = '';	public $action = '';	public $view = '';	public $url = '';	public $documentRoot = '';	public $templatePath = '';	public $defaultController = '';	function __construct($view='')	{		$this->view = $view;		$this->baseurl = "http://".$_SERVER['HTTP_HOST'];		$this->documentRoot = $_SERVER['DOCUMENT_ROOT'];		if(substr($this->documentRoot,-1)=="/")			$this->documentRoot = substr($this->documentRoot,0,-1);		$this->templatePath = $this->documentRoot."/_template";		$this->templateUrl = $this->baseurl."/_template";			}	public function setClass($classPath, $class)	{		global $_classPath;		echo $class;		$class = ucfirst(str_replace('Action','',$class));		if($this->isExistsClass($classPath."/".$class.'Controller'))		{			$_classPath = $classPath."/".$class;			$this->controller = Lemon_Instance::getObject($class.'Controller');			$this->action = 'indexAction';			$this->setController();		}	}	/*	* 객체 생성하려는 클래스 파일이 실제 존재 하는지 검사	*/	public function isExistsClass($className)	{		global $vhost;				$expath = "";		if(strpos($className,"_")!==false)		{			$expath = substr($className,0,strrpos($className,"_"));			$expath = strtolower(str_replace("_","/",$expath))."/";		}				$path = $_SERVER['DOCUMENT_ROOT']."/../Lemonade/".$vhost."/controller/".$expath.$className.".php";		if(is_file($path))			return true;		else			return false;	}	public function run()	{		global $_classPath;		$this->url = $_SERVER['REQUEST_URI'];		$this->url = str_replace("http://",'',$this->url);		$this->url = substr($this->url,strpos($this->url,"/")+1);		if(strpos($this->url,"?")!==false)			$this->url = substr($this->url,0,strpos($this->url,"?"));				$urlSplit = explode("/",$this->url);		if(sizeof($urlSplit)>2)		{			for($i=0;$i<sizeof($urlSplit)-1;$i++)			{				$dir .= ucfirst($urlSplit[$i]) . "_";			}						$dir = substr($dir,0,-1);			$cname = $dir."Controller";						//echo "controller : " . $dir."Controller<br>";			//echo "action : " . $urlSplit[sizeof($urlSplit)-1].'Action' . "<br>";						if($this->isExistsClass($dir.'Controller'))			{				$this->controller = Lemon_Instance::getObject($dir.'Controller');								if($urlSplit[sizeof($urlSplit)-1]!='')					$this->action = $urlSplit[sizeof($urlSplit)-1].'Action';				else					$this->action = 'IndexAction';			}			else 			{				throw new Lemon_HtmlException("Error","해당 controller 를 찾을 수 없습니다");				exit;			}		}		else if(sizeof($urlSplit)==2)		{			$cname = ucfirst($urlSplit[0]).'Controller';			if($this->isExistsClass(ucfirst($urlSplit[0]).'Controller'))			{				$this->controller = Lemon_Instance::getObject(ucfirst($urlSplit[0]).'Controller');				if($urlSplit[1]!='')					$this->action = $urlSplit[1].'Action';				else					$this->action = "indexAction";			}			else {				throw new Lemon_HtmlException("Error","해당 controller 를 찾을 수 없습니다");				exit;			}					}		else if(sizeof($urlSplit)==1)		{			$cname = "IndexController";						if($urlSplit[0]!=""){				$this->controller = Lemon_Instance::getObject('IndexController');				$this->action = $urlSplit[sizeof($urlSplit)-1].'Action';			}			else {				$this->controller = Lemon_Instance::getObject('IndexController');				$this->action = 'indexAction';			}		}				//echo "cname : " . $cname . "<br>";		//echo "action : " . $this->action . "<br>";				// 템플릿소스의 절대경로		$this->controller->setTemplatePath($this->templatePath);		// 템플릿소스의 URL		$this->controller->setTemplateUrl($this->templateUrl);		// 컨트롤러에서 사용할 view 객체를 세팅		$this->controller->setView($this->view);			}}?>